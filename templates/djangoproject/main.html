<!doctype html>
<html lang="en">
  <head>
    {# static.js연결 <link rel="stylesheet" href="{% static 'js/server.js' %}">#}

      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Bootstrap CSS -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
       {% load static %}
      <!--jquery-->
      <script src="https://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios@1.1.3/dist/axios.min.js"></script>

      <!--fonts-->
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
      <script src="https://kit.fontawesome.com/654f345186.js" crossorigin="anonymous"></script>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Asap+Condensed:ital,wght@1,600&family=Do+Hyeon&family=Playfair+Display&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Asap+Condensed:ital,wght@1,300&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <title>red code</title>

  <style>
      {#.body.dark-mode {#}
      {#    background-color: black;#}
      {#    color: white;#}
      .navbar-brand {
          font-family: 'Asap Condensed', sans-serif; /* 폰트 종류 지정 */
          font-size: 32px; /* 폰트 크기 지정 */
          font-weight: bold; /* 폰트 굵기 지정 */
          color: black; /* 폰트 색상 지정 */
          text-indent: 40px;
      }

      .navbar-brand:hover {
          color: black;
      }

      .main-box {
          display: flex;
          justify-content: center;
          padding-top: 80px;
          background-color: white;
          text-align: center;
      }
      .main-right-box{
          width:400px;
          height:900px;
          background-color:white;
          left:57%;
      }

      .box {
          width: 150px;
          height: 150px;
          border-radius: 70%;
          overflow: hidden;
      }

      .profile {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      .modal_overlay {
          width: 100%;
          height: 100%;
          position: absolute;
          left: 0;
          top: 0;
          display: none;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          background: rgba(0, 0, 0, 0.8);
          backdrop-filter: blur(1.5px);
          -webkit-backdrop-filter: blur(1.5px);
      }

      .modal_window {
          background: white;
          backdrop-filter: blur(13.5px);
          -webkit-backdrop-filter: blur(13.5px);
          border-radius: 10px;
          border: 1px solid rgba(255, 255, 255, 0.18);
          width: 800px;
          height: 600px;
          position: relative;
          padding: 10px;
      }

      {# 대화창 코드 #}
      .chat-content{
          height: 445px;
          overflow-y: scroll;
      }
      .line{
          margin-top: 10px;
          display: flex;
      }
      .chat-box{
          background-color: #eee;
          padding: 5px;
          max-width: 200px;
      }
      .mine{
          margin-left: auto;
      }

  </style>
{#      <script>#}
{#          function toggleDarkMode() {#}
{#              var body = document.body;#}
{#              body.classList.toggle('dark-mode')#}
{#          }#}
{#      </script>#}
  </head>
  <body>

  <!--navber -->
  <nav class="navbar navbar-expand-lg "style="position: fixed; background-color: white; width: 100%; hight: 70px;">
      <div class="container-fluid">
          <a class="navbar-brand" href="/main">REDCODE</a>
          <div class="collapse navbar-collapse" id="navbarSupportedContent " style="padding-right: 40px;">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
              <input class="form-control me-2" style="width:300px; height:33px;" type="Search" placeholder="Search" aria-label="Search">
          </div>
<!--navber 오른쪽 친구들-->
          <span style="display: flex; word-spacing: 15px; color: black; font-size: 20px; font-family: 'Asap Condensed', sans-serif;">
          <a class= "home_symbol" href="/main" style="padding-right: 48px; text-decoration: none; color: black" >home</a>
          <span id="navbar_add_box" style="padding-right: 40px;" >upload</span>
          <span class="send_symbol" style="padding-right: 40px;" >dark</span>
          <div class="dropdown" style="padding-right: 40px">
          <a class="#" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <div class="box" style="width: 37px; height: 37px;">
                   <img class="profile"
                        src="{% get_media_prefix %}{{user.profile}}">
          </div>
          </a>
        <ul class="dropdown-menu" style="left: -125px">
            <li><a class="dropdown-item" href="/content/mainprofile">프로필</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/user/logout">로그아웃</a></li>
        </ul>
          </div>
          </span>
      </div>
  </nav>
{#  여기에 이미지 추가하면 됨 #}
{#      <div style="display: flex;#}
{#          justify-content: center;#}
{#          padding-top: 80px;#}
{#          background-color: white;">#}
{#          <div id="carouselExample" class="carousel slide">#}
{#              <div class="carousel-inner">#}
{#                  <div class="carousel-item active">#}
{#                      <img src="/media/bg_1.png" class="d-block w-100" alt="...">#}
{#                  </div>#}
{#                  <div class="carousel-item">#}
{#                      <img src="/media/bg_2.png" class="d-block w-100" alt="...">#}
{#                  </div>#}
{#              </div>#}
{#              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"#}
{#                      data-bs-slide="prev">#}
{#                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>#}
{#                  <span class="visually-hidden">Previous</span>#}
{#              </button>#}
{#              <button class="carousel-control-next" type="button" data-bs-target="#carouselExample"#}
{#                      data-bs-slide="next">#}
{#                  <span class="carousel-control-next-icon" aria-hidden="true"></span>#}
{#                  <span class="visually-hidden">Next</span>#}
{#              </button>#}
{#          </div>#}
{#      </div>#}

  <!--피드랑 친찾 묶음-->
  <div class="main-box">
<!--피드-->
      <div class="main-inbox" style="display: flex; flex-direction: column; width:500px; min-width: 500px; height:20px; margin-right:50px;">
          {% for feed in feed_list %} <!--얘는 이 자리가 아니면 안됨-->
          <div class="container" style="border: solid 1px gray ; background-color: white; margin: 10px">
                  <div style="display: flex; flex-direction: row; align-items: center; margin:8px;">
                      <div class="box" style="width: 45px; height: 45px;">
                          <img class="profile" src="{% get_media_prefix %}{{feed.profile}}"></div>
                      <div class="ID" style="margin-left: 10px;">{{ feed.nickname }}</div>
                  </div>

                  <div><img style="width: 100%" src="{% get_media_prefix %}{{ feed.image }}"></div>
            <div class="fonts"
                   style="margin: 5px; display: flex; flex-direction: row; justify-content: space-between;">
                  <div style="word-spacing: 7px;">
                      <span id="favorite_{{ feed.id }}" feed_id="{{ feed.id }}" class="favorite material-symbols-outlined" style="color: red;cursor: pointer">
                          {% if feed.is_liked %}
                              favorite
                          {% else %}
                              favorite_border
                          {% endif %}
                      </span>
                  </div>
                  <div>
                      <span id="bookmark_{{ feed.id }}" feed_id="{{ feed.id }}" class="bookmark material-symbols-outlined" style="cursor: pointer">
                              {% if feed.is_marked %}
                                  bookmark
                              {% else %}
                                  bookmark_border
                              {% endif %}
                          </span>
                  </div>
              </div>
              <div style="margin-left: 13px; text-align: left; font-size: 14px;">
                  <b>{{ feed.like_count }}명</b>이 좋아합니다.
              </div>
              <div style="margin-left: 13px; text-align: left; font-size: 14px;">
                  <b>{{ feed.nickname }}</b>{{ feed.content }}</div>

              <div id="reply_list_{{ feed.id }}">
                  {% for reply in feed.reply_list %}
                      <div style="margin-left: 13px; text-align: left; font-size: 14px;">
                          <b>{{ reply.nickname }}</b>{{ reply.reply_content }}</div>
                  {% endfor %}
              </div>

              <div class="text-input" style="display:flex;flex-direction: row;align-items: center; border-top: solid 1px gray; margin-top: 7px; ">
                  <input id="reply_{{ feed.id }}" type="text" class="form-control" style="box-shadow: none; border: none; outline: none;" id="exampleFormControlInput1" placeholder="댓글달기...">
                  <div feed_id="{{ feed.id }}" class="upload_reply" style="width: 50px; color: cornflowerblue; font-weight: bold">게시</div>
              </div>
          </div>
        {% endfor %}
      </div>

<!--gpt부분-->
      <div class="main-right-box">
           <div style="display: flex; flex-direction: row; align-items: center; margin:7px;">
               <div class="box" style="width: 60px; height: 60px;">

                   <img class="profile"
                        src="{% get_media_prefix %}{{user.profile}}">
               </div>
               <div class="ID" style="margin-left: 10px; text-align: left; ">
                   <div>
                       {{ user.nickname }}
                   </div>
                   <div style="color: gray">
                       {{ user.name }}
                   </div>
               </div>
           </div>
          
          <div style="display: flex; flex-direction: row; justify-content: space-between; margin: 5px;">
          <div style=" color: grey">chat GPT: 무엇이 궁금한가요? </div>
          </div>
          <div class = "chat-content">
              <div class = "line">
                  <span class = "chat-box">...</span>
              </div>
              <div class ="line">
                  <span class = "chat-box mine">...</span>
              </div>
          </div>
          <input class="chat-box" id="input">
          <button id = "send" class="btn btn-light">send a message</button>

{#쓰잘데기 없는 부분#}
          <div style="flex-direction: row; font-size: 10px; text-align: left; margin:4px;">
              <div style="color:#c7c7c7; margin-top: 40px;">소개 도움말 홍보센터 API</div>
              <div style="color:#c7c7c7; margin-top: 4px;">개인정보처리방침 약관 위치 언어</div>
          </div>
      </div>
    </div>
  <!--첫번 째 모달 -->
  <div id="first_modal" class="modal_overlay">
      <div class="modal_window">
          <div style="display: flex; flex-direction: row; justify-content: space-between">
              <div style="width: 40px;"></div>
              <div>
                  새 게시물 만들기
              </div>
              <div style="width: 40px;">
                  <span class="modal_close material-symbols-outlined">close</span>
              </div>
          </div>
          <div class="image_upload_space" style="border-top: solid 1px gray; height: 514px; width: 777px; margin-top: 10px;"></div>
      </div>
  </div>

  <!--두번 째 모달-->
  <div id="second_modal" class="modal_overlay">
      <div class="modal_window">
          <div style="display: flex; flex-direction: row; justify-content: space-between">
              <div style="width: 40px;"></div>
              <div>
                  새 이미지 업로드
              </div>
              <div style="width: 40px;">
                  <span class="modal_close material-symbols-outlined">close</span>
              </div>
          </div>
          <div style="border-top: solid 1px gray; display: flex; flex-direction: row; margin-top: 10px;">
              <div class="image_upload_space"
                   style="height: 514px; width: 486px;">
              </div>
              <div style="border-left: solid 1px gray">
                  <div>
                    <textarea id="input_feed_content" class="form-control" style="width: 276px; height: 400px"
                              rows="5" placeholder="설명을 입력하세요..."></textarea>
                  </div>
                  <button id="feed_create_button" type="button" class="btn btn-primary" style="width: 100%">
                      공유하기
                  </button>
              </div>
          </div>
      </div>
  </div>

  {#대화창  JavaScript - papago번역기눙 추가#}

  <script src="https://cdn.jsdelivr.net/npm/axios@1.1.3/dist/axios.min.js"></script>
  <script type ="module">
      import {Configuration, OpenAIApi} from 'https://cdn.skypack.dev/openai';

      document.querySelector('#send').addEventListener('click', function () {
          var template = `<div class="line">
              <span class ="chat-box mine">${document.querySelector('#input').value}
              </span>
          </div>`
          document.querySelector('.chat-content').insertAdjacentHTML('beforeend', template);

          const configuration = new Configuration({
              apiKey: '...', //키 입력
          });
          const openai = new OpenAIApi(configuration);

          openai.createCompletion({
              model: "text-davinci-003",
              prompt: document.querySelector('#input').value, //INPUT에 입력된 글자가 AI로 넘어감
              temperature: 0.7,
              max_tokens: 64, //허용가능한 tokens의 최대
              top_p: 1.0,
              frequency_penalty: 0.0,
              presence_penalty: 0.0,
          }).then((result)=>{ //그리고 답변을 받는데 그게 result에 들어감
              console.log(result.data.choices[0].text) //AI가 답변한게 들어옴
               var template = `<div class="line">
              <span class ="chat-box">${ result.data.choices[0].text}
              </span>
          </div>`
          document.querySelector('.chat-content').insertAdjacentHTML('beforeend', template);
              //AI가 답장이 HTML창에 생성되도록 만들어주는 코드
          })
      })
  </script>


  <!-- Optional JavaScript; choose one of the two! 원래 있던 제이쿼리-->
  <script>
      $(".bookmark").click(function (event){
          let feed_id = event.target.attributes.getNamedItem('feed_id').value;
          let bookmark_id = event.target.id;
          let bookmark_text = $.trim($('#'+bookmark_id).html());
          if(bookmark_text == 'bookmark'){
              $('#'+bookmark_id).html("bookmark_border");
          }else{
              $('#'+bookmark_id).html("bookmark");
          }
          $.ajax({
              url: "/content/bookmark",
              data: {
                  feed_id: feed_id,
                  bookmark_text: bookmark_text
              },
              method: "POST",
              success: function (data) {
                  console.log("성공");
              },
              error: function (request, status, error) {
                  console.log("error");
              },
              complete: function () {
                  console.log("완료");
              }
          });
      });

      $(".favorite").click(function (event){
          let feed_id = event.target.attributes.getNamedItem('feed_id').value;
          let favorite_id = event.target.id;
          let favorite_text = $.trim($('#'+favorite_id).html());
          if(favorite_text == 'favorite'){
              $('#'+favorite_id).html("favorite_border");
          }else{
              $('#'+favorite_id).html("favorite");
          }
          $.ajax({
              url: "/content/like",
              data: {
                  feed_id: feed_id,
                  favorite_text: favorite_text
              },
              method: "POST",
              success: function (data) {
                  console.log("성공");
              },
              error: function (request, status, error) {
                  console.log("error");
              },
              complete: function () {
                  console.log("완료");
              }
          });
      });

      $(".upload_reply").click(function (event){
          let feed_id = event.target.attributes.getNamedItem('feed_id').value;
          let reply_id = 'reply_' + feed_id
          console.log(reply_id)
          reply_content = $('#'+reply_id).val()
          console.log(reply_content);

          if(reply_content.length <= 0){
              alert("댓글을 입력하세요");
              return 0;
          }
           $.ajax({
              url: "/content/reply",
              data: {
                  feed_id: feed_id,
                  reply_content: reply_content
              },
              method: "POST",
              success: function (data) {
                  console.log("성공");
                  $("#reply_list_" + feed_id).append("<div style='margin: 0 20px; text-align:left; font-size: 14px'<b>{{user.nickname}}</b>"+reply_content+"</div>")
                  {#location.replace('/main');#}
              },
              error: function (request, status, error) {
                  console.log("error");
              },
              complete: function () {
                  console.log("완료");
                  $('#'+reply_id).val('');
              }
          })
      });

      $(".modal_close").click(function () {
          $('#first_modal').css({
              display: 'none'
          });
          $('#second_modal').css({
              display: 'none'
          });
      });

      let files;

      $('#navbar_add_box').click(function(){
          $('#first_modal').css({
              display: 'flex'
          });
          $(document.body).css({
              overflow : 'hidden'
          });
      });

      $('#feed_create_button').click(function (){
          alert("공유하기를 눌렀다.");
          let file = files[0];
          let image= files[0].name;
          let content= $('#input_feed_content').val();

          let fd = new FormData();

          fd.append('file',file);
          fd.append('image', image);
          fd.append('content', content);

          $.ajax({
              url: "/content/upload",
              data: fd,
              method: "POST",
              processData: false,
              contentType: false,
              success: function (data) {
                  console.log("성공");
              },
              error: function (request, status, error) {
                  console.log("error");
              },
              complete: function () {
                  console.log("완료");
                  location.replace("/main");
              }
          })
      });

      $('.image_upload_space')
          .on("dragover", dragOver)
          .on("dragleave", dragOver)
          .on("drop", uploadFiles);

      function dragOver(e) {
          e.stopPropagation();
          e.preventDefault();

          console.log(e)

          if(e.type == "dragover"){
              $(e.target).css({
                  "background-color": "black",
                  "outline-offset": "-20px"
              });
          }else {
              $(e.target).css({
                  "outline-offset": "-10px"
              });
          }
      }
      function uploadFiles(e) {
          e.stopPropagation();
          e.preventDefault();

          dragOver(e);

          e.dataTransfer = e.originalEvent.dataTransfer;
          files = e.target.files || e.dataTransfer.files;
          console.log("뭔가 파일을 올렸네??" + files[0].name);

          if(files.length > 1){
              alert('하나만 올려라.');
              return;
          }

          if(files[0].type.match(/image.*/)) {
              $('#first_modal').css({
                  display: 'none'
              });
              $('#second_modal').css({
                  display: 'flex'
              });

              $('.image_upload_space').css({
                  "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                  "outline": "none",
                  "background-size": "100%",
                  "background-repeat": "no-repeat",
                  "background-position": "center"
              });
          }
          else{
              alert('이미지가 아닙니다.');
              return;
          }
      }


  </script>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  </body>
</html>